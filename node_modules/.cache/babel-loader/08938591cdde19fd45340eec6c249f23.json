{"ast":null,"code":"var _jsxFileName = \"/home/elouati/Bureau/projet_working/client/src/Game/animator/AnimatorLoader.js\";\nimport React from 'react';\nimport { socket } from '../../socket.js';\nimport PropTypes from 'prop-types';\nimport { generateHexes, generateRivers } from \"../map/MapUtil.js\";\nimport Bassin from \"../map/Bassin.js\";\nimport handleClickTile from '../controls/handleClickTileFarmer.js';\nimport ChangeTile from './ChangeTile.js';\nimport Menu from '../controls/Menu.js';\nimport { Button, Typography } from '@material-ui/core'; //import CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\n//import CheckBoxIcon from '@material-ui/icons/CheckBox';\n\nimport ConfirmDialog from \"../controls/ConfirmDialog.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default class AnimatorLoader extends React.Component {\n  /* \n      Input : props={name}\n              name: string : name of the player\n      \n      Syntax : <AnimatorLoader name=\"player's name\"/>\n  */\n  constructor(props) {\n    super(props);\n\n    this.addConvo = data => {\n      if (data.convoName.length === 0) {\n        alert(\"vous devez entrer un nom\");\n        return false;\n      }\n\n      for (const entry in this.state.lstConvo) {\n        if (entry === data.convoName) {\n          alert(\"Nom déjà pris\");\n          return false;\n        }\n      }\n\n      let newConvo = [];\n      const name = data.convoName;\n\n      for (const entry in data.lstPlayer) {\n        if (!(entry === \"convoName\" || entry === \"lstConvo\")) {\n          if (data.lstPlayer[entry]) newConvo.push(entry);\n        }\n      }\n\n      if (newConvo.length > 0) {\n        this.setState({\n          lstConvo: { ...this.state.lstConvo,\n            [name]: newConvo\n          }\n        });\n        return true;\n      }\n\n      alert(\"Vous devez selectionner des joueurs\");\n      return false;\n    };\n\n    this.updateMap = tileChange => {\n      let tile = this.state.map.moreHexas[tileChange.selectedTile - 1];\n      delete tileChange.selectedTile;\n      tile = this.updateObject(tile, tileChange);\n      this.setState({\n        selectedTile: \"\"\n      });\n    };\n\n    this.handleSubmit = () => {\n      /*         console.log(this.state.action)\n              switch (this.state.action) {\n                  case \"Commencer la partie\":\n                      this.setState({ mapReady: false })\n                      socket.emit(\"mapReady\")\n                      break;\n                  case \"Terminer la partie\":\n                      socket.emit(\"endGame\")\n                      break;\n                  default:\n                      socket.emit(\"nextTurn\", () => {\n                          socket.emit(\"getTurn\", (response) => {\n                              this.setState({ tour: response })\n                          })\n                      })\n              } */\n      const action = this.actionToString();\n\n      if (action === \"Finir les modifications\") {\n        if (this.state.tour === -1) {\n          socket.emit(\"mapReady\");\n          console.log(\"mapReady\");\n          this.setState({\n            tour: 0\n          });\n        } else {\n          socket.emit(\"inputPhase\");\n          console.log(\"inputphase\");\n        }\n      } else socket.emit(\"nextTurn\", () => {\n        socket.emit(\"getTurn\", response => {\n          console.log(response);\n          this.setState({\n            tour: response\n          });\n        });\n      });\n\n      this.setState({\n        displayConfirmDialog: false,\n        farmersPlaying: !this.state.farmersPlaying\n      });\n    };\n\n    this.cancel = () => {\n      this.setState({\n        displayConfirmDialog: false\n      });\n    };\n\n    this.handleContinue = event => {\n      /* console.log(event.currentTarget, event.currentTarget.name)\n      this.setState({ farmersPlaying: !this.state.farmersPlaying })\n      if (!this.state.farmersPlaying) { socket.emit(\"inputPhase\", () => { }) } */\n      this.setState({\n        action: event.currentTarget.name,\n        displayConfirmDialog: true\n      });\n    };\n\n    this.state = {\n      lstPlayer: \"\",\n      lstTile: \"\",\n      map: {\n        moreHexas: \"\",\n        moreRivers: null\n      },\n      mapReady: true,\n      tour: -1,\n      action: \"\",\n      disconnected: false,\n      farmersPlaying: false\n    }; //this.addConvo = this.addConvo.bind(this)\n\n    this.handleClickTile = handleClickTile.bind(this);\n  }\n\n  /* \n      Function : componentDidMount\n       Description : retrieve the map and players's data\n       Author : Hugo KELHETTER\n    */\n  componentDidMount() {\n    socket.on(\"disconnect\", () => {\n      this.setState({\n        disconnected: true\n      });\n    });\n    socket.on(\"connect\", () => {\n      if (this.state.disconnected) {\n        socket.emit('reconnect', this.props.room, this.props.name, () => {\n          this.setState({\n            disconnected: false\n          });\n        });\n      }\n    });\n    socket.emit(\"getCurrentGrid\", response => {\n      const newHexas = generateHexes(response);\n      let lstTile = newHexas[1];\n      const newRivers = generateRivers(newHexas[0]); //const tampon = this.createTampon(newHexas, this.state.map.player)\n\n      this.setState({\n        map: { ...this.state.map,\n          moreHexas: newHexas[0],\n          moreRivers: newRivers,\n          selectedTile: null\n        },\n        lstTile\n      });\n    });\n    socket.emit(\"playersInRoom\", response => {\n      this.setState({\n        lstPlayer: response\n      }); //})\n    });\n  }\n  /* \n      Function : updateObject\n       Syntax  : obj=updateObject(source,newData)\n       Input   : source : object : the object to update\n                newData : object : the object containing new data\n       Output  : obj : object : an updated object\n       Description : update source with the subset of data contained in newData\n                      let source = {firstname:hugo,name:kelhetter} and newData={firstname:jhon}\n                      let newObject=updateObject(source,newData)\n                      newObject = {firstname:jhon,name:kelhetter}\n       Author : Hugo KELHETTER\n  \n  */\n\n\n  updateObject(source, newData) {\n    for (const key in newData) {\n      source[key] = newData[key];\n    }\n\n    return source;\n  }\n  /* \n      Function : updateMap\n       Syntax  : updateMap(tileChange)\n       Input   : tileChange : object : new set of data for a tile of the map\n       Description : update the map with new data\n       Author : Hugo KELHETTER\n  \n  */\n\n\n  openTuto() {\n    window.open(`${window.location.href}tutorial?tuto=2`);\n  }\n\n  actionToString() {\n    if (this.state.farmersPlaying) return \"Finir le tour\";\n    return \"Finir les modifications\";\n  }\n\n  endGame() {\n    socket.emit(\"endGame\");\n  }\n  /* \n  Function : render\n   Syntax  : render()\n   Description : display the UI of the animator : the map, and controls over the map and the game in general\n   Author : Hugo KELHETTER\n  */\n\n\n  render() {\n    var _this$state$selectedT;\n\n    console.log(this.state.tour);\n    const buttonValue = this.actionToString(); //const buttonValue = this.state.mapReady ? \"Commencer la partie\" : `Terminer le tour ${this.state.tour}`\n\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [this.state.displayConfirmDialog && /*#__PURE__*/_jsxDEV(ConfirmDialog, {\n        cancel: this.cancel,\n        confirm: this.handleSubmit,\n        action: this.state.action\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 49\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App\",\n        children: [/*#__PURE__*/_jsxDEV(Menu, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"menu\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"primary\",\n              onClick: this.openTuto,\n              children: \"Aide\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              children: [\"tour actuel : \", this.state.tour]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              children: [\" \", this.state.mapReady && \"Vous pouvez modifier la carte avant le début de la partie. \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              children: \" Cliquez sur une case pour apporter des modifications\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 257,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              children: [\" L'identifiant de la partie est : \", this.props.room]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"primary\",\n              \"data-testid\": \"submit\",\n              name: buttonValue,\n              value: buttonValue,\n              onClick: this.handleContinue,\n              children: buttonValue\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 259,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"primary\",\n              \"data-testid\": \"submit\",\n              name: \"Terminer la partie\",\n              onClick: this.endGame,\n              children: \"Terminer la partie\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 251,\n            columnNumber: 25\n          }, this), this.state.lstPlayer !== \"\" && this.state.lstTile !== \"\" && this.state.selectedTile && !this.state.farmersPlaying && /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"changeTile\",\n            children: /*#__PURE__*/_jsxDEV(ChangeTile, {\n              lstPlayer: this.state.lstPlayer,\n              lstTile: this.state.map.moreHexas,\n              updateMap: this.updateMap,\n              selectedTile: this.state.selectedTile,\n              type: this.state.selectedTile.className,\n              id: this.state.selectedTile.id\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 21\n        }, this), this.state.map.moreHexas !== \"\" && /*#__PURE__*/_jsxDEV(Bassin, {\n          handleClick: this.handleClickTile,\n          selectedId: (_this$state$selectedT = this.state.selectedTile) === null || _this$state$selectedT === void 0 ? void 0 : _this$state$selectedT.id,\n          map: this.state.map,\n          role: this.props.role,\n          id: this.state.id\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 56\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true);\n  }\n\n}\nAnimatorLoader.propTypes = {\n  name: PropTypes.string.isRequired\n};","map":{"version":3,"sources":["/home/elouati/Bureau/projet_working/client/src/Game/animator/AnimatorLoader.js"],"names":["React","socket","PropTypes","generateHexes","generateRivers","Bassin","handleClickTile","ChangeTile","Menu","Button","Typography","ConfirmDialog","AnimatorLoader","Component","constructor","props","addConvo","data","convoName","length","alert","entry","state","lstConvo","newConvo","name","lstPlayer","push","setState","updateMap","tileChange","tile","map","moreHexas","selectedTile","updateObject","handleSubmit","action","actionToString","tour","emit","console","log","response","displayConfirmDialog","farmersPlaying","cancel","handleContinue","event","currentTarget","lstTile","moreRivers","mapReady","disconnected","bind","componentDidMount","on","room","newHexas","newRivers","source","newData","key","openTuto","window","open","location","href","endGame","render","buttonValue","className","id","role","propTypes","string","isRequired"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { socket } from '../../socket.js'\nimport PropTypes from 'prop-types';\nimport { generateHexes, generateRivers } from \"../map/MapUtil.js\"\nimport Bassin from \"../map/Bassin.js\"\nimport handleClickTile from '../controls/handleClickTileFarmer.js'\nimport ChangeTile from './ChangeTile.js'\nimport Menu from '../controls/Menu.js'\nimport { Button, Typography } from '@material-ui/core'\n//import CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\n//import CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport ConfirmDialog from \"../controls/ConfirmDialog.js\"\n\nexport default class AnimatorLoader extends React.Component {\n    /* \n        Input : props={name}\n                name: string : name of the player\n        \n        Syntax : <AnimatorLoader name=\"player's name\"/>\n    */\n    constructor(props) {\n        super(props)\n        this.state = {\n            lstPlayer: \"\", lstTile: \"\", map: { moreHexas: \"\", moreRivers: null }, mapReady: true, tour: -1, action: \"\",\n            disconnected: false, farmersPlaying: false\n\n        }\n        //this.addConvo = this.addConvo.bind(this)\n        this.handleClickTile = handleClickTile.bind(this)\n\n    }\n    static propTypes = {\n        name: PropTypes.string.isRequired\n    }\n    /* \nFunction : addConvo\n\nSyntax  : boolean=addConvo(data)\n\nInput   : object following the next pattern\n            {\n                convoName : \"name of the conversation\",\n                player1 : boolean,\n                player2 : boolean\n                ...\n            }\n            playerN's represents the player's name and the value represents \n                    whether or not it is part of the conversation\n\nOutput  : the success of the function\n\nDescription : display the different components of the app\n\nAuthor : Hugo KELHETTER\n    \n*/\n    addConvo = (data) => {\n\n        if (data.convoName.length === 0) {\n            alert(\"vous devez entrer un nom\")\n            return false\n        }\n        for (const entry in this.state.lstConvo) {\n            if (entry === data.convoName) {\n                alert(\"Nom déjà pris\")\n                return false\n            }\n        }\n\n        let newConvo = []\n        const name = data.convoName\n        for (const entry in data.lstPlayer) {\n            if (!(entry === \"convoName\" || entry === \"lstConvo\")) {\n                if (data.lstPlayer[entry]) newConvo.push(entry)\n            }\n        }\n\n        if (newConvo.length > 0) {\n            this.setState({ lstConvo: { ...this.state.lstConvo, [name]: newConvo } })\n            return true\n        }\n        alert(\"Vous devez selectionner des joueurs\")\n        return false\n    }\n    /* \n        Function : componentDidMount\n\n        Description : retrieve the map and players's data\n\n        Author : Hugo KELHETTER\n \n    */\n    componentDidMount() {\n        socket.on(\"disconnect\", () => {\n            this.setState({ disconnected: true });\n        })\n\n        socket.on(\"connect\", () => {\n            if (this.state.disconnected) {\n                socket.emit('reconnect', this.props.room, this.props.name, () => {\n                    this.setState({ disconnected: false })\n                });\n            }\n        })\n\n        socket.emit(\"getCurrentGrid\", (response) => {\n            const newHexas = generateHexes(response)\n            let lstTile = newHexas[1]\n            const newRivers = generateRivers(newHexas[0])\n            //const tampon = this.createTampon(newHexas, this.state.map.player)\n            this.setState({ map: { ...this.state.map, moreHexas: newHexas[0], moreRivers: newRivers, selectedTile: null }, lstTile })\n\n        })\n        socket.emit(\"playersInRoom\", (response) => {\n            this.setState({ lstPlayer: response })\n            //})\n        })\n    }\n    /* \n        Function : updateObject\n\n        Syntax  : obj=updateObject(source,newData)\n\n        Input   : source : object : the object to update\n                  newData : object : the object containing new data\n\n        Output  : obj : object : an updated object\n\n        Description : update source with the subset of data contained in newData\n                        let source = {firstname:hugo,name:kelhetter} and newData={firstname:jhon}\n                        let newObject=updateObject(source,newData)\n                        newObject = {firstname:jhon,name:kelhetter}\n\n        Author : Hugo KELHETTER\n    \n    */\n    updateObject(source, newData) {\n        for (const key in newData) {\n            source[key] = newData[key]\n        }\n        return source\n    }\n    /* \n        Function : updateMap\n\n        Syntax  : updateMap(tileChange)\n\n        Input   : tileChange : object : new set of data for a tile of the map\n\n        Description : update the map with new data\n\n        Author : Hugo KELHETTER\n    \n    */\n\n    updateMap = (tileChange) => {\n        let tile = this.state.map.moreHexas[tileChange.selectedTile - 1]\n        delete tileChange.selectedTile\n        tile = this.updateObject(tile, tileChange)\n        this.setState({ selectedTile: \"\" })\n    }\n    /* \n        Function : handleSubmit\n\n        Syntax  : handleSubmit()\n\n        Description : if mapReady == false then it starts the game for other players\n                      else it ends the turn\n\n        Author : Hugo KELHETTER\n    \n    */\n    handleSubmit = () => {\n        /*         console.log(this.state.action)\n                switch (this.state.action) {\n                    case \"Commencer la partie\":\n                        this.setState({ mapReady: false })\n                        socket.emit(\"mapReady\")\n                        break;\n                    case \"Terminer la partie\":\n                        socket.emit(\"endGame\")\n                        break;\n                    default:\n                        socket.emit(\"nextTurn\", () => {\n                            socket.emit(\"getTurn\", (response) => {\n                                this.setState({ tour: response })\n                            })\n                        })\n                } */\n        const action = this.actionToString()\n        if (action === \"Finir les modifications\") {\n            if (this.state.tour === -1) {\n                socket.emit(\"mapReady\")\n                console.log(\"mapReady\")\n                this.setState({ tour: 0 })\n            }\n            else {\n                socket.emit(\"inputPhase\")\n                console.log(\"inputphase\")\n            }\n        }\n        else socket.emit(\"nextTurn\", () => {\n            socket.emit(\"getTurn\", (response) => {\n                console.log(response)\n\n                this.setState({ tour: response })\n            })\n        })\n        this.setState({ displayConfirmDialog: false, farmersPlaying: !this.state.farmersPlaying })\n    }\n    cancel = () => {\n        this.setState({ displayConfirmDialog: false })\n    }\n    handleContinue = (event) => {\n        /* console.log(event.currentTarget, event.currentTarget.name)\n        this.setState({ farmersPlaying: !this.state.farmersPlaying })\n        if (!this.state.farmersPlaying) { socket.emit(\"inputPhase\", () => { }) } */\n        this.setState({ action: event.currentTarget.name, displayConfirmDialog: true })\n    }\n\n    openTuto() {\n        window.open(`${window.location.href}tutorial?tuto=2`)\n    }\n    actionToString() {\n        if (this.state.farmersPlaying) return \"Finir le tour\"\n        return \"Finir les modifications\"\n    }\n    endGame() {\n        socket.emit(\"endGame\")\n    }\n    /* \n    Function : render\n\n    Syntax  : render()\n\n    Description : display the UI of the animator : the map, and controls over the map and the game in general\n\n    Author : Hugo KELHETTER\n \n*/\n    render() {\n        console.log(this.state.tour)\n        const buttonValue = this.actionToString()\n        //const buttonValue = this.state.mapReady ? \"Commencer la partie\" : `Terminer le tour ${this.state.tour}`\n        return (<>\n            {this.state.displayConfirmDialog && <ConfirmDialog cancel={this.cancel} confirm={this.handleSubmit} action={this.state.action} />}\n\n            <div className=\"App\">\n                {\n                    < Menu >\n                        <div id=\"menu\">\n                            <Button variant=\"contained\" color=\"primary\" onClick={this.openTuto}>\n                                Aide\n                            </Button>\n                            <Typography>tour actuel : {this.state.tour}</Typography>\n                            <Typography> {this.state.mapReady && \"Vous pouvez modifier la carte avant le début de la partie. \"}</Typography>\n                            <Typography> Cliquez sur une case pour apporter des modifications</Typography>\n                            <Typography> L'identifiant de la partie est : {this.props.room}</Typography>\n                            <Button variant=\"contained\" color=\"primary\" data-testid=\"submit\" name={buttonValue} value={buttonValue} onClick={this.handleContinue}>\n                                {buttonValue}\n                            </Button>\n\n                            <Button variant=\"contained\" color=\"primary\" data-testid=\"submit\" name=\"Terminer la partie\" onClick={this.endGame}>\n                                Terminer la partie\n                            </Button>\n                        </div>\n                        {(this.state.lstPlayer !== \"\" && this.state.lstTile !== \"\" && this.state.selectedTile && !this.state.farmersPlaying) &&\n                            <div id=\"changeTile\">\n                                <ChangeTile lstPlayer={this.state.lstPlayer} lstTile={this.state.map.moreHexas} updateMap={this.updateMap}\n                                    selectedTile={this.state.selectedTile} type={this.state.selectedTile.className} id={this.state.selectedTile.id} />\n                            </div>\n                        }\n                    </Menu>\n                }\n                {\n                    this.state.map.moreHexas !== \"\" && <Bassin handleClick={this.handleClickTile} selectedId={this.state.selectedTile?.id}\n                        map={this.state.map} role={this.props.role} id={this.state.id} />\n                }\n            </div >\n        </>);\n    }\n}"]},"metadata":{},"sourceType":"module"}